<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Calendar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div id="root">Loading...</div>

  <script>
    // ==================== STATE VARIABLES ====================
    let currentDate = new Date();
    let viewMode = 'month';
    let events = [
      {
        id: 1,
        title: "Team standup",
        date: new Date(2025, 8, 10, 9, 0),
        category: "work",
        color: "#3b82f6"
      },
      {
        id: 2,
        title: "Lunch with Sarah",
        date: new Date(2025, 8, 12, 12, 30),
        category: "personal",
        color: "#10b981"
      }
    ];

    let showInput = false;
    let inputText = '';
    let showSettings = false;

    // Theme settings
    let backgroundColor = '#ffffff';
    let textColor = '#000000';
    let categories = {
      work: "#3b82f6",
      personal: "#10b981",
      health: "#f59e0b",
      social: "#8b5cf6"
    };

    // Temporary settings (for cancel functionality)
    let tempBackgroundColor = backgroundColor;
    let tempTextColor = textColor;
    let tempCategories = { ...categories };

    // ==================== CALENDAR FUNCTIONS ====================
    function getDaysInMonth(date) {
      const year = date.getFullYear();
      const month = date.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();

      const days = [];

      for (let i = 0; i < startingDayOfWeek; i++) {
        days.push(null);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        days.push(day);
      }

      return days;
    }

    function getEventsForDay(day) {
      if (!day) return [];
      const targetDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
      return events.filter(event =>
        event.date.toDateString() === targetDate.toDateString()
      );
    }

    function formatMonth(date) {
      const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN',
        'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
      return `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
    }

    function navigate(direction) {
      const newDate = new Date(currentDate);
      newDate.setMonth(currentDate.getMonth() + direction);
      currentDate = newDate;
      render();
    }

    function parseNaturalLanguage(text) {
      const now = new Date();
      let eventDate = new Date(now);
      let eventTime = null;
      let title = text;
      let category = "personal";

      const timeRegex = /(\d{1,2}):?(\d{0,2})\s*(am|pm|AM|PM)?/;
      const timeMatch = text.match(timeRegex);
      if (timeMatch) {
        let hours = parseInt(timeMatch[1]);
        let minutes = timeMatch[2] ? parseInt(timeMatch[2]) : 0;
        const ampm = timeMatch[3]?.toLowerCase();

        if (ampm === 'pm' && hours !== 12) hours += 12;
        if (ampm === 'am' && hours === 12) hours = 0;

        eventTime = { hours, minutes };
      }

      const today = new Date(now);
      if (text.includes('tomorrow')) {
        eventDate.setDate(today.getDate() + 1);
      } else if (text.includes('next monday')) {
        const daysUntilMonday = (8 - today.getDay()) % 7 || 7;
        eventDate.setDate(today.getDate() + daysUntilMonday);
      }

      if (eventTime) {
        eventDate.setHours(eventTime.hours, eventTime.minutes, 0, 0);
      }

      if (text.includes('meeting') || text.includes('work') || text.includes('boss')) {
        category = 'work';
      } else if (text.includes('doctor') || text.includes('gym')) {
        category = 'health';
      } else if (text.includes('party') || text.includes('friends')) {
        category = 'social';
      }

      title = text
        .replace(/at \d{1,2}:?\d{0,2}\s*(am|pm)?/i, '')
        .replace(/next (monday|tuesday|wednesday|thursday|friday|saturday|sunday)/i, '')
        .replace(/tomorrow/i, '')
        .trim();

      return {
        title: title || 'New Event',
        date: eventDate,
        category,
        color: categories[category]
      };
    }

    function addEvent() {
      if (inputText.trim()) {
        const parsedEvent = parseNaturalLanguage(inputText);
        const newEvent = {
          id: Date.now(),
          ...parsedEvent
        };
        events.push(newEvent);
        inputText = '';
        showInput = false;
        render();
      }
    }

    // ==================== SETTINGS FUNCTIONS ====================
    function openSettings() {
      showSettings = true;
      // Set temporary values to current values
      tempBackgroundColor = backgroundColor;
      tempTextColor = textColor;
      tempCategories = { ...categories };
      render();
    }

    function closeSettings() {
      showSettings = false;
      render();
    }

    function saveSettings() {
      backgroundColor = tempBackgroundColor;
      textColor = tempTextColor;
      categories = { ...tempCategories };

      // Update existing events with new category colors
      events.forEach(event => {
        event.color = categories[event.category];
      });

      showSettings = false;
      render();
    }

    function resetToDefaults() {
      tempBackgroundColor = '#ffffff';
      tempTextColor = '#000000';
      tempCategories = {
        work: "#3b82f6",
        personal: "#10b981",
        health: "#f59e0b",
        social: "#8b5cf6"
      };
      render();
    }

    function updateTempCategoryColor(category, color) {
      tempCategories[category] = color;
      render();
    }

    // ==================== RENDER FUNCTION ====================
    function render() {
      const days = getDaysInMonth(currentDate);
      const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

      let calendarGrid = '';
      days.forEach((day, index) => {
        const dayEvents = getEventsForDay(day);
        const isToday = day &&
          new Date().toDateString() ===
          new Date(currentDate.getFullYear(), currentDate.getMonth(), day).toDateString();

        let eventHtml = '';
        dayEvents.forEach(event => {
          const time = event.date.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          });
          eventHtml += `
            <div class="text-xs p-2 rounded-lg text-white font-bold truncate cursor-pointer hover:opacity-80 transition-all duration-200 border border-gray-400 mb-1 shadow-sm transform hover:scale-[1.02]"
                 style="background: linear-gradient(135deg, ${event.color} 0%, ${event.color}dd 100%);">
              ${time} ${event.title}
            </div>
          `;
        });

        calendarGrid += `
          <div class="border-b border-r border-gray-300 min-h-[100px] p-3 hover:bg-gray-50 transition-all duration-200 cursor-pointer">
            ${day ? `
              <div class="text-lg font-black mb-2 ${isToday ? 'w-8 h-8 rounded-full flex items-center justify-center text-white shadow-lg' : ''}" 
                   style="color: ${isToday ? backgroundColor : textColor}; background-color: ${isToday ? textColor : 'transparent'}">
                ${day}
              </div>
              <div class="space-y-1">
                ${eventHtml}
              </div>
            ` : ''}
          </div>
        `;
      });

      document.getElementById('root').innerHTML = `
        <div class="max-w-md mx-auto min-h-screen" style="background-color: ${backgroundColor}; color: ${textColor}">
          <!-- Header -->
          <div class="px-6 py-6 border-b border-gray-300" style="background-color: ${backgroundColor === '#ffffff' ? '#f5f5f5' : backgroundColor}; color: ${textColor}">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <div class="w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-lg flex items-center justify-center">
                  <div class="w-3 h-3 bg-white rounded-sm opacity-90"></div>
                </div>
                <h1 class="text-2xl font-black tracking-wide drop-shadow-sm" style="color: ${textColor}">CALENDAR</h1>
              </div>
              <div class="w-6 h-6 bg-gradient-to-br from-gray-400 to-gray-500 rounded-lg cursor-pointer hover:from-gray-500 hover:to-gray-600 transition-all duration-200 shadow-sm"
                   onclick="openSettings()"></div>
            </div>
          </div>

          <!-- Navigation -->
          <div class="flex items-center justify-between px-6 py-6 border-b border-gray-300 shadow-lg" 
               style="background: linear-gradient(to right, ${textColor}, ${textColor}dd); color: ${backgroundColor}">
            <button onclick="navigate(-1)" class="p-3 hover:bg-white hover:bg-opacity-10 rounded-full transition-all duration-200 transform hover:scale-105">
              <div class="w-0 h-0 border-t-[6px] border-b-[6px] border-r-[10px] border-t-transparent border-b-transparent drop-shadow-sm" 
                   style="border-right-color: ${backgroundColor}"></div>
            </button>
            <h2 class="text-3xl font-black uppercase tracking-wider drop-shadow-lg" style="font-stretch: condensed; letter-spacing: 0.1em; color: ${backgroundColor}">
              ${formatMonth(currentDate)}
            </h2>
            <button onclick="navigate(1)" class="p-3 hover:bg-white hover:bg-opacity-10 rounded-full transition-all duration-200 transform hover:scale-105">
              <div class="w-0 h-0 border-t-[6px] border-b-[6px] border-l-[10px] border-t-transparent border-b-transparent drop-shadow-sm" 
                   style="border-left-color: ${backgroundColor}"></div>
            </button>
          </div>

          <!-- View Mode Selector -->
          <div class="flex mx-6 my-6 rounded-2xl p-2 border border-gray-300 shadow-lg" style="background-color: ${backgroundColor}">
            <button class="flex-1 py-4 px-6 text-lg font-black rounded-xl transition-all duration-200 uppercase tracking-wider transform hover:scale-[1.02] ${viewMode === 'month' ? 'shadow-lg' : 'hover:bg-gray-50'}"
                    onclick="viewMode='month'; render()" 
                    style="background: ${viewMode === 'month' ? `linear-gradient(to right, ${textColor}, ${textColor}dd)` : 'transparent'}; color: ${viewMode === 'month' ? backgroundColor : textColor}">
              month
            </button>
            <button class="flex-1 py-4 px-6 text-lg font-black rounded-xl transition-all duration-200 uppercase tracking-wider transform hover:scale-[1.02] ${viewMode === 'week' ? 'shadow-lg' : 'hover:bg-gray-50'}"
                    onclick="viewMode='week'; render()"
                    style="background: ${viewMode === 'week' ? `linear-gradient(to right, ${textColor}, ${textColor}dd)` : 'transparent'}; color: ${viewMode === 'week' ? backgroundColor : textColor}">
              week
            </button>
            <button class="flex-1 py-4 px-6 text-lg font-black rounded-xl transition-all duration-200 uppercase tracking-wider transform hover:scale-[1.02] ${viewMode === 'day' ? 'shadow-lg' : 'hover:bg-gray-50'}"
                    onclick="viewMode='day'; render()"
                    style="background: ${viewMode === 'day' ? `linear-gradient(to right, ${textColor}, ${textColor}dd)` : 'transparent'}; color: ${viewMode === 'day' ? backgroundColor : textColor}">
              day
            </button>
          </div>

          <!-- Calendar Grid -->
          <div class="overflow-auto" style="background-color: ${backgroundColor}">
            <!-- Week Days Header -->
            <div class="grid grid-cols-7 border-b border-gray-300" style="background: linear-gradient(to right, ${backgroundColor === '#ffffff' ? '#f5f5f5' : backgroundColor}, ${backgroundColor === '#ffffff' ? '#f0f0f0' : backgroundColor}dd)">
              ${weekDays.map(day => `
                <div class="p-4 text-center text-sm font-bold uppercase tracking-widest" style="color: ${textColor}">
                  ${day}
                </div>
              `).join('')}
            </div>

            <!-- Calendar Days -->
            <div class="grid grid-cols-7" style="background-color: ${backgroundColor}">
              ${calendarGrid}
            </div>
          </div>

          <!-- Add Button -->
          <button onclick="showInput=true; render()" 
                  class="fixed bottom-6 right-6 w-16 h-16 rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 transform hover:scale-110 hover:shadow-3xl"
                  style="background: linear-gradient(135deg, ${textColor}, ${textColor}dd); color: ${backgroundColor}">
            <div class="text-3xl font-bold drop-shadow-lg">+</div>
          </button>

          <!-- Add Event Modal -->
          ${showInput ? `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex items-end z-50 backdrop-blur-sm">
              <div class="bg-white w-full rounded-t-3xl p-6 space-y-4 border-t border-gray-300 shadow-2xl transform transition-all duration-300">
                <div class="flex items-center justify-between">
                  <h3 class="text-xl font-black text-gray-800 uppercase tracking-wider">Add Event</h3>
                  <button onclick="showInput=false; render()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold transition-colors duration-200 transform hover:scale-110">
                    ×
                  </button>
                </div>
                <div class="space-y-3">
                  <p class="text-sm text-gray-600 font-bold">
                    Try: "Meeting at 5pm next monday with boss" or "Gym tomorrow at 7am"
                  </p>
                  <div class="flex space-x-2">
                    <input type="text" id="eventInput" 
                           value="${inputText}"
                           onchange="inputText=this.value"
                           onkeyup="if(event.key==='Enter') addEvent()"
                           placeholder="Describe your event..."
                           class="flex-1 px-4 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900 bg-white text-gray-800 font-bold placeholder-gray-500 transition-all duration-200 shadow-sm">
                  </div>
                  <button onclick="addEvent()" 
                          class="w-full text-white py-4 rounded-xl font-black uppercase tracking-wide transition-all duration-200 shadow-lg transform hover:scale-[1.02]"
                          style="background: linear-gradient(to right, ${textColor}, ${textColor}dd)">
                    Add Event
                  </button>
                </div>
              </div>
            </div>
          ` : ''}

          <!-- Settings Modal -->
          ${showSettings ? `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-6 backdrop-blur-sm">
              <div class="bg-white w-full max-w-sm rounded-2xl p-6 space-y-6 border border-gray-300 shadow-2xl max-h-[90vh] overflow-y-auto">
                <div class="flex items-center justify-between">
                  <h3 class="text-xl font-black text-black uppercase tracking-wider">Settings</h3>
                  <button onclick="closeSettings()" class="text-gray-500 hover:text-black text-2xl font-bold transition-colors duration-200">
                    ×
                  </button>
                </div>

                <div class="space-y-4">
                  <h4 class="text-lg font-bold text-black uppercase tracking-wide">Theme</h4>
                  
                  <!-- Background Color -->
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                      <div class="w-8 h-8 rounded-full border-2 border-gray-400" style="background-color: ${tempBackgroundColor}"></div>
                      <span class="text-lg font-bold text-black uppercase tracking-wide">Background</span>
                    </div>
                    <input type="color" value="${tempBackgroundColor}" 
                           onchange="tempBackgroundColor=this.value; render()"
                           class="w-16 h-10 border-2 border-gray-400 rounded-lg cursor-pointer">
                  </div>

                  <!-- Text Color -->
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                      <div class="w-8 h-8 rounded-full border-2 border-gray-400" style="background-color: ${tempTextColor}"></div>
                      <span class="text-lg font-bold text-black uppercase tracking-wide">Text</span>
                    </div>
                    <input type="color" value="${tempTextColor}" 
                           onchange="tempTextColor=this.value; render()"
                           class="w-16 h-10 border-2 border-gray-400 rounded-lg cursor-pointer">
                  </div>
                </div>

                <div class="space-y-4">
                  <h4 class="text-lg font-bold text-black uppercase tracking-wide">Categories</h4>
                  ${Object.entries(tempCategories).map(([category, color]) => `
                    <div class="flex items-center justify-between">
                      <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 rounded-full border-2 border-gray-400" style="background: linear-gradient(135deg, ${color}, ${color}dd)"></div>
                        <span class="text-lg font-bold text-black uppercase tracking-wide">${category}</span>
                      </div>
                      <input type="color" value="${color}" 
                             onchange="updateTempCategoryColor('${category}', this.value)"
                             class="w-16 h-10 border-2 border-gray-400 rounded-lg cursor-pointer">
                    </div>
                  `).join('')}
                </div>

                <div class="flex space-x-3 pt-4 border-t border-gray-300">
                  <button onclick="resetToDefaults()" 
                          class="flex-1 bg-gray-200 hover:bg-gray-300 text-black py-4 rounded-xl font-black uppercase tracking-wide transition-colors border border-gray-400">
                    Reset
                  </button>
                  <button onclick="saveSettings()" 
                          class="flex-1 bg-black hover:bg-gray-800 text-white py-4 rounded-xl font-black uppercase tracking-wide transition-colors">
                    Save
                  </button>
                </div>
              </div>
            </div>
          ` : ''}

          <!-- Category Legend -->
          <div class="px-6 py-4 border-t border-gray-300" style="background: linear-gradient(to right, ${backgroundColor === '#ffffff' ? '#f5f5f5' : backgroundColor}, ${backgroundColor === '#ffffff' ? '#f0f0f0' : backgroundColor}dd)">
            <div class="flex flex-wrap gap-4">
              ${Object.entries(categories).map(([category, color]) => `
                <div class="flex items-center space-x-2">
                  <div class="w-4 h-4 rounded-full border border-gray-300 shadow-sm" style="background: linear-gradient(135deg, ${color} 0%, ${color}dd 100%);"></div>
                  <span class="text-sm font-bold uppercase tracking-wide" style="color: ${textColor}">${category}</span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;

      // Focus input if modal is open
      if (showInput) {
        setTimeout(() => {
          const input = document.getElementById('eventInput');
          if (input) input.focus();
        }, 100);
      }
    }

    // ==================== GLOBAL FUNCTIONS ====================
    window.navigate = navigate;
    window.addEvent = addEvent;
    window.render = render;
    window.openSettings = openSettings;
    window.closeSettings = closeSettings;
    window.saveSettings = saveSettings;
    window.resetToDefaults = resetToDefaults;
    window.updateTempCategoryColor = updateTempCategoryColor;

    // Initial render
    render();
  </script>
</body>

</html>